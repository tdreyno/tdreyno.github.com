var animate,camera,cols,currentTime,geometry,go,gravity,gridSizeX,gridSizeY,imageHeight,imageWidth,init,mesh,mouse,physics,render,renderer,rows,scene;scene=null,camera=null,physics=null,renderer=null,geometry=null,mouse=null,gravity=null,mesh=null,imageWidth=600,imageHeight=300,gridSizeX=600,gridSizeY=100,cols=imageWidth/gridSizeX,rows=imageHeight/gridSizeY,init=function(){var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r;scene=new THREE.Scene,camera=new THREE.PerspectiveCamera(75,1.6,1,1e4),camera.position.z=500,scene.add(camera),b=new THREE.PlaneGeometry(imageWidth*1.1,imageHeight,1,1),n=THREE.ImageUtils.loadTexture("images/image2.png"),e=new THREE.MeshBasicMaterial({map:n}),f=new THREE.Mesh(b,e),f.position.z=-100,scene.add(f),geometry=new THREE.PlaneGeometry(imageWidth,imageHeight,cols,rows),geometry.dynamic=!0,m=THREE.ImageUtils.loadTexture("images/image.jpg"),d=new THREE.MeshBasicMaterial({map:m}),mesh=new THREE.Mesh(geometry,d),scene.add(mesh),renderer=new THREE.WebGLRenderer,renderer.setSize(960,600),document.getElementById("container").appendChild(renderer.domElement),physics=new Physics(new Verlet),gravity=new ConstantForce(new Vector(0,-80)),physics.behaviours.push(gravity),i=function(){var a,b,c,d;c=geometry.vertices,d=[];for(a=0,b=c.length;a<b;a++)o=c[a],h=new Particle(.1),h.moveTo(new Vector(o.position.x,o.position.y,0)),h.fixed=o.position.y===imageHeight/2,d.push(h);return d}(),l=1,r=[];for(c=p=0,q=i.length;p<q;c=++p)h=i[c],h.pos.x<imageWidth/2&&i[c+1]&&(k=new Spring(h,i[c+1],gridSizeX,l),physics.springs.push(k)),j=Math.floor(c/cols),a=c%cols,g=(j+1)*cols+a+1,i[g]&&(k=new Spring(h,i[g],gridSizeY,l),physics.springs.push(k)),r.push(physics.particles.push(h));return r},currentTime=null,animate=function(a){var b;return b=0,currentTime&&(b=a-currentTime),TWEEN.update(a),requestAnimationFrame(animate),physics.step(),render(),currentTime=a},render=function(){var a,b,c,d,e;renderer.render(scene,camera);for(a=d=0,e=physics.particles.length;0<=e?d<e:d>e;a=0<=e?++d:--d)b=physics.particles[a],c=geometry.vertices[a],c.position.x=b.pos.x,c.position.y=b.pos.y,c.position.z=b.pos.z;return geometry.__dirtyVertices=!0},init(),animate(),go=function(a){var b,c,d,e,f,g,h,i,j;a==null&&(a=2),h=null,i=null,g=a*(cols+1),c=g+cols,h==null&&(h=physics.particles[g].pos.y),i==null&&(i=physics.particles[g].pos.z),f=function(){var a,b,f,h;f=physics.particles,h=[];for(d=a=0,b=f.length;a<b;d=++a)e=f[d],g<=d&&d<=c&&h.push(e);return h}(),b={y:0},j=(new TWEEN.Tween(b)).to({y:-100},2e3).easing(TWEEN.Easing.Quadratic.InOut).onUpdate(function(b){var c,d,e,g,j,k;c=h+gridSizeY*(a-1)*2*b,d=i+40*b,k=[];for(g=0,j=f.length;g<j;g++)e=f[g],e.pos.y=c,k.push(e.pos.z=d);return k}).onComplete(function(){}),j.start();return},document.body.addEventListener("dblclick",function(){return go()});