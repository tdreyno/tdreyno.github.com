/* Allows safe, dyamic creation of namespaces.
*/
var Attraction,Behaviour,Collision,ConstantForce,EdgeBounce,EdgeWrap,Particle,Physics,Random,Spring,Vector,Wander,namespace,__hasProp=Object.prototype.hasOwnProperty,__extends=function(a,b){function d(){this.constructor=a}for(var c in b)__hasProp.call(b,c)&&(a[c]=b[c]);return d.prototype=b.prototype,a.prototype=new d,a.__super__=b.prototype,a};namespace=function(a){var b,c,d,e,f,g,h;c=self,f=a.split("."),h=[];for(d=0,e=f.length;d<e;d++)b=f[d],h.push(c=(g=c[b])!=null?g:c[b]={});return h},function(){var a,b,c,d,e;a=0,c=["ms","moz","webkit","o"];for(d=0,e=c.length;d<e;d++){b=c[d];if(!!window.requestAnimationFrame)continue;window.requestAnimationFrame=window[b+"RequestAnimationFrame"],window.cancelRequestAnimationFrame=window[b+"CancelRequestAnimationFrame"]}window.requestAnimationFrame||(window.requestAnimationFrame=function(b,c){var d,e,f;return e=(new Date).getTime(),d=Math.max(0,16-(e-f)),setTimeout(function(){return b(a+d)},d),f=e+d});if(!window.cancelAnimationFrame)return window.cancelAnimationFrame=function(a){return clearTimeout(a)}}(),Random=function(a,b){return b==null&&(b=a,a=0),a+Math.random()*(b-a)},Random.int=function(a,b){return b==null&&(b=a,a=0),Math.floor(a+Math.random()*(b-a))},Random.sign=function(a){return a==null&&(a=.5),Math.random()<a?1:-1},Random.bool=function(a){return a==null&&(a=.5),Math.random()<a},Random.item=function(a){return a[Math.floor(Math.random()*a.length)]},Vector=function(){function a(a,b,c){this.x=a!=null?a:0,this.y=b!=null?b:0,this.z=c!=null?c:0}return a.add=function(b,c){return new a(b.x+c.x,b.y+c.y,b.z+c.z)},a.sub=function(b,c){return new a(b.x-c.x,b.y-c.y,b.z-c.z)},a.project=function(a,b){return a.clone().scale(a.dot(b)/a.magSq())},a.prototype.set=function(a,b,c){return this.x=a,this.y=b,this.z=c,this},a.prototype.add=function(a){return this.x+=a.x,this.y+=a.y,this.z+=a.z,this},a.prototype.sub=function(a){return this.x-=a.x,this.y-=a.y,this.z-=a.z,this},a.prototype.scale=function(a){return this.x*=a,this.y*=a,this.z*=a,this},a.prototype.dot=function(a){return this.x*a.x+this.y*a.y+this.z*a.z},a.prototype.cross=function(a){return this.x*a.y-this.y*a.x-this.y*a.y},a.prototype.mag=function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},a.prototype.magSq=function(){return this.x*this.x+this.y*this.y+this.z*this.z},a.prototype.dist=function(a){var b,c,d;return b=a.x-this.x,c=a.y-this.y,d=a.z-this.z,Math.sqrt(b*b+c*c+d*d)},a.prototype.distSq=function(a){var b,c,d;return b=a.x-this.x,c=a.y-this.y,d=a.z-this.z,b*b+c*c+d*d},a.prototype.norm=function(){var a;return a=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z),this.x/=a,this.y/=a,this.z/=a,this},a.prototype.limit=function(a){var b,c;c=this.x*this.x+this.y*this.y+this.z*this.z;if(c>a*a)return b=Math.sqrt(c),this.x/=b,this.y/=b,this.z/=b,this.x*=a,this.y*=a,this.z*=a,this},a.prototype.copy=function(a){return this.x=a.x,this.y=a.y,this.z=a.z,this},a.prototype.clone=function(){return new a(this.x,this.y,this.z)},a.prototype.clear=function(){return this.x=0,this.y=0,this.z=0,this},a}(),Particle=function(){function a(a){this.mass=a!=null?a:1,this.setMass(this.mass),this.setRadius(1),this.fixed=!1,this.behaviours=[],this.pos=new Vector,this.vel=new Vector,this.acc=new Vector,this.old={pos:new Vector,vel:new Vector,acc:new Vector}}return a.prototype.moveTo=function(a){return this.pos.copy(a),this.old.pos.copy(a)},a.prototype.setMass=function(a){return this.mass=a!=null?a:1,this.massInv=1/this.mass},a.prototype.setRadius=function(a){return this.radius=a!=null?a:1,this.radiusSq=this.radius*this.radius},a.prototype.update=function(a,b){var c,d,e,f,g;if(!this.fixed){f=this.behaviours,g=[];for(d=0,e=f.length;d<e;d++)c=f[d],g.push(c.apply(this,a,b));return g}},a}(),Spring=function(){function a(a,b,c,d){this.p1=a,this.p2=b,this.restLength=c!=null?c:100,this.stiffness=d!=null?d:1,this._delta=new Vector}return a.prototype.apply=function(){var a,b;this._delta.copy(this.p2.pos).sub(this.p1.pos),a=this._delta.mag()+1e-6,b=(a-this.restLength)/(a*(this.p1.massInv+this.p2.massInv))*this.stiffness,this.p1.fixed||this.p1.pos.add(this._delta.clone().scale(b*this.p1.massInv));if(!this.p2.fixed)return this.p2.pos.add(this._delta.scale(-b*this.p2.massInv))},a}(),Physics=function(){function a(a){this.integrator=a!=null?a:new Euler,this.timestep=1/60,this.viscosity=.005,this.behaviours=[],this._time=0,this._step=0,this._clock=null,this._buffer=0,this._maxSteps=4,this.particles=[],this.springs=[]}return a.prototype.integrate=function(a){var b,c,d,e,f,g,h,i,j,k,l,m,n,o;c=1-this.viscosity,l=this.particles;for(d=0,i=l.length;d<i;d++){e=l[d],m=this.behaviours;for(g=0,j=m.length;g<j;g++)b=m[g],b.apply(e,a,d);e.update(a,d)}this.integrator.integrate(this.particles,a,c),n=this.springs,o=[];for(h=0,k=n.length;h<k;h++)f=n[h],o.push(f.apply());return o},a.prototype.step=function(){var a,b,c;this._clock==null&&(this._clock=(new Date).getTime()),c=(new Date).getTime(),a=c-this._clock;if(a<=0)return;a*=.001,this._clock=c,this._buffer+=a,b=0;while(this._buffer>=this.timestep&&++b<this._maxSteps)this.integrate(this.timestep),this._buffer-=this.timestep,this._time+=this.timestep;return this._step=(new Date).getTime()-c},a.prototype.destroy=function(){return this.integrator=null,this.particles=null,this.springs=null},a}(),Behaviour=function(){function a(){this.GUID=a.GUID++,this.interval=1}return a.GUID=0,a.prototype.apply=function(a,b,c){var d,e;return((e=a[d="__behaviour"+this.GUID])!=null?e:a[d]={counter:0}).counter++},a}(),Attraction=function(a){function b(a,c,d){this.target=a!=null?a:new Vector,this.radius=c!=null?c:1e3,this.strength=d!=null?d:100,this._delta=new Vector,this.setRadius(this.radius),b.__super__.constructor.apply(this,arguments)}return __extends(b,a),b.prototype.setRadius=function(a){return this.radius=a,this.radiusSq=a*a},b.prototype.apply=function(a,b,c){var d;this._delta.copy(this.target).sub(a.pos),d=this._delta.magSq();if(d<this.radiusSq&&d>1e-6)return this._delta.norm().scale(1-d/this.radiusSq),a.acc.add(this._delta.scale(this.strength))},b}(Behaviour),Collision=function(a){function b(a,c){this.useMass=a!=null?a:!0,this.callback=c!=null?c:null,this.pool=[],this._delta=new Vector,b.__super__.constructor.apply(this,arguments)}return __extends(b,a),b.prototype.apply=function(a,b,c){var d,e,f,g,h,i,j,k,l,m,n;n=[];for(f=c,m=this.pool.length-1;c<=m?f<=m:f>=m;c<=m?f++:f--)h=this.pool[f],h!==a?(this._delta.copy(h.pos).sub(a.pos),e=this._delta.magSq(),l=a.radius+h.radius,e<=l*l?(d=Math.sqrt(e),i=a.radius+h.radius-d,i+=.5,g=a.mass+h.mass,j=this.useMass?h.mass/g:.5,k=this.useMass?a.mass/g:.5,a.pos.add(this._delta.clone().norm().scale(i*-j)),h.pos.add(this._delta.norm().scale(i*k)),n.push(typeof this.callback=="function"?this.callback(a,h,i):void 0)):n.push(void 0)):n.push(void 0);return n},b}(Behaviour),ConstantForce=function(a){function b(a){this.force=a!=null?a:new Vector,b.__super__.constructor.apply(this,arguments)}return __extends(b,a),b.prototype.apply=function(a,b,c){return a.acc.add(this.force)},b}(Behaviour),EdgeBounce=function(a){function b(a,c){this.min=a!=null?a:new Vector,this.max=c!=null?c:new Vector,b.__super__.constructor.apply(this,arguments)}return __extends(b,a),b.prototype.apply=function(a,b,c){a.pos.x-a.radius<this.min.x?a.pos.x=this.min.x+a.radius:a.pos.x+a.radius>this.max.x&&(a.pos.x=this.max.x-a.radius);if(a.pos.y-a.radius<this.min.y)return a.pos.y=this.min.y+a.radius;if(a.pos.y+a.radius>this.max.y)return a.pos.y=this.max.y-a.radius},b}(Behaviour),EdgeWrap=function(a){function b(a,c){this.min=a!=null?a:new Vector,this.max=c!=null?c:new Vector,b.__super__.constructor.apply(this,arguments)}return __extends(b,a),b.prototype.apply=function(a,b,c){a.pos.x+a.radius<this.min.x?(a.pos.x=this.max.x+a.radius,a.old.pos.x=a.pos.x):a.pos.x-a.radius>this.max.x&&(a.pos.x=this.min.x-a.radius,a.old.pos.x=a.pos.x);if(a.pos.y+a.radius<this.min.y)return a.pos.y=this.max.y+a.radius,a.old.pos.y=a.pos.y;if(a.pos.y-a.radius>this.max.y)return a.pos.y=this.min.y-a.radius,a.old.pos.y=a.pos.y},b}(Behaviour),Wander=function(a){function b(a,c,d){this.jitter=a!=null?a:.5,this.radius=c!=null?c:100,this.strength=d!=null?d:1,this.theta=Math.random()*Math.PI*2,b.__super__.constructor.apply(this,arguments)}return __extends(b,a),b.prototype.apply=function(a,b,c){return this.theta+=(Math.random()-.5)*this.jitter*Math.PI*2,a.acc.x+=Math.cos(this.theta)*this.radius*this.strength,a.acc.y+=Math.sin(this.theta)*this.radius*this.strength},b}(Behaviour);