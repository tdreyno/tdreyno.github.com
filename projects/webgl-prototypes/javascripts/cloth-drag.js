var animate,camera,cols,currentTime,geometry,gravity,gridSizeX,gridSizeY,imageHeight,imageWidth,init,mesh,mouse,physics,render,renderer,rows,scene;scene=null,camera=null,physics=null,renderer=null,geometry=null,mouse=null,gravity=null,mesh=null,imageWidth=600,imageHeight=300,gridSizeX=60,gridSizeY=60,cols=imageWidth/gridSizeX,rows=imageHeight/gridSizeY,init=function(){var a,b,c,d,e,f,g,h,i,j,k,l,m;scene=new THREE.Scene,camera=new THREE.PerspectiveCamera(75,1.6,1,1e4),camera.position.z=500,scene.add(camera),geometry=new THREE.PlaneGeometry(imageWidth,imageHeight,cols,rows),geometry.dynamic=!0,j=THREE.ImageUtils.loadTexture("images/image.jpg"),c=new THREE.MeshBasicMaterial({map:j}),mesh=new THREE.Mesh(geometry,c),scene.add(mesh),renderer=new THREE.WebGLRenderer,renderer.setSize(960,600),document.getElementById("container").appendChild(renderer.domElement),physics=new Physics(new Verlet),gravity=new ConstantForce(new Vector(0,-80)),physics.behaviours.push(gravity),f=function(){var a,b,c,d;c=geometry.vertices,d=[];for(a=0,b=c.length;a<b;a++)k=c[a],e=new Particle(.1),e.moveTo(new Vector(k.position.x,k.position.y,0)),e.fixed=k.position.y===imageHeight/2,d.push(e);return d}(),i=1;for(b=l=0,m=f.length;l<m;b=++l)e=f[b],e.pos.x<imageWidth/2&&f[b+1]&&(h=new Spring(e,f[b+1],gridSizeX,i),physics.springs.push(h)),g=Math.floor(b/cols),a=b%cols,d=(g+1)*cols+a+1,f[d]&&(h=new Spring(e,f[d],gridSizeY,i),physics.springs.push(h)),physics.particles.push(e);return mouse=new Particle,mouse.fixed=!0,mouse.active=!1,renderer.domElement.addEventListener("mousemove",function(a){var b;return mouse.active||(b=physics.particles[physics.particles.length-1-cols/2],h=new Spring(mouse,b,30,1),physics.springs.push(h),mouse.active=!0),mouse.pos.set(a.clientX-480,-(a.clientY-300-100),100)})},currentTime=null,animate=function(a){var b;return b=0,currentTime&&(b=a-currentTime),TWEEN.update(a),requestAnimationFrame(animate),physics.step(),render(),currentTime=a},render=function(){var a,b,c,d,e;renderer.render(scene,camera);for(a=d=0,e=physics.particles.length;0<=e?d<e:d>e;a=0<=e?++d:--d)b=physics.particles[a],c=geometry.vertices[a],c.position.x=b.pos.x,c.position.y=b.pos.y,c.position.z=b.pos.z;return geometry.__dirtyVertices=!0},init(),animate();